-- Variables for today's date and start of the current year
DECLARE @today DATE;
DECLARE @start_of_year DATE;

-- Set today's date and start of the current year
SET @today = GETDATE();
SET @start_of_year = DATEFROMPARTS(YEAR(@today), 1, 1);

-- Calculate today's inflow
DECLARE @today_inflow INT;
SELECT @today_inflow = COUNT(*)
FROM A_HIST
WHERE CAST(create_ts AS DATE) = @today;

-- Calculate the yearly average inflow (excluding today)
DECLARE @yearly_average FLOAT;
SELECT @yearly_average = (COUNT(*) * 1.0) / DATEDIFF(DAY, @start_of_year, @today)
FROM A_HIST
WHERE create_ts >= @start_of_year
  AND create_ts < @today;

-- Check if today's inflow is greater than 120% of the yearly average
IF @today_inflow > (@yearly_average * 1.2)
BEGIN
    PRINT 'Today''s inflow is greater than 120% of the yearly average';
END
ELSE
BEGIN
    PRINT 'Today''s inflow is within the normal range';
END;
